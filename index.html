<html>
    <body></body>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@1.3.1/dist/tf.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@0.8/dist/teachablemachine-image.min.js"></script>
    <script type="text/javascript">
        const URL = "https://teachablemachine.withgoogle.com/models/szxI-Pu9p/";
        const image = new Image();
        async function init() {
            image.src = "http://localhost:3000";
            image.crossOrigin = "anonymous";
            document.querySelector("body").appendChild(image);
            const modelURL = URL + "model.json";
            const metadataURL = URL + "metadata.json";

            model = await tmImage.load(modelURL, metadataURL);
        }

        // run the webcam image through the image model
        async function predict() {
            // predict can take in an image, video or canvas html element
            const prediction = await model.predict(image);
            prediction.forEach((p) => {
                console.log(p.className + ": " + p.probability.toFixed(2));
            });
            return prediction;
        }

        (async () => {
            await init();
            const results = await predict();
            let p1, p2;
            results.forEach((p) => {
                if (p.className === "1Prodotto") {
                    p1 = p.probability.toFixed(2);
                } else p2 = p.probability.toFixed(2);
            });
            fetch(`http://localhost:3000/send?p1=${p1}&p2=${p2}`);
        })();
    </script>
</html>
